<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TracDice â€” P2P On-Chain Dice Casino</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #060608;
    --surface: #0d0d12;
    --border: #1e1e2e;
    --neon: #00ffe1;
    --neon2: #ff2d78;
    --neon3: #ffe600;
    --text: #e0e0f0;
    --muted: #5a5a7a;
    --win: #00ffe1;
    --lose: #ff2d78;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Space Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  /* Animated grid bg */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,255,225,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,255,225,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .scanline {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--neon), transparent);
    animation: scan 4s linear infinite;
    opacity: 0.4;
    z-index: 1;
    pointer-events: none;
  }
  @keyframes scan { 0% { top: -2px; } 100% { top: 100vh; } }

  .container {
    position: relative;
    z-index: 2;
    max-width: 720px;
    margin: 0 auto;
    padding: 40px 20px 80px;
  }

  /* Header */
  header {
    text-align: center;
    margin-bottom: 50px;
  }

  .logo {
    font-family: 'Bebas Neue', cursive;
    font-size: clamp(60px, 12vw, 100px);
    letter-spacing: 8px;
    line-height: 1;
    background: linear-gradient(135deg, var(--neon), var(--neon2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0 0 30px rgba(0,255,225,0.4));
    animation: pulse-logo 3s ease-in-out infinite;
  }
  @keyframes pulse-logo {
    0%, 100% { filter: drop-shadow(0 0 20px rgba(0,255,225,0.3)); }
    50% { filter: drop-shadow(0 0 50px rgba(0,255,225,0.7)); }
  }

  .tagline {
    color: var(--muted);
    font-size: 11px;
    letter-spacing: 4px;
    text-transform: uppercase;
    margin-top: 8px;
  }

  .network-badge {
    display: inline-block;
    margin-top: 16px;
    padding: 4px 14px;
    border: 1px solid var(--neon);
    color: var(--neon);
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    position: relative;
    overflow: hidden;
  }
  .network-badge::before {
    content: '';
    position: absolute;
    left: -100%;
    top: 0; bottom: 0;
    width: 100%;
    background: rgba(0,255,225,0.1);
    animation: badge-sweep 2s ease-in-out infinite;
  }
  @keyframes badge-sweep { 0% { left: -100%; } 100% { left: 100%; } }

  /* Balance card */
  .balance-card {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 24px;
    margin-bottom: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
    overflow: hidden;
  }
  .balance-card::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--neon), transparent);
  }
  .balance-label {
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 6px;
  }
  .balance-amount {
    font-family: 'Bebas Neue', cursive;
    font-size: 42px;
    color: var(--neon3);
    letter-spacing: 2px;
    line-height: 1;
    text-shadow: 0 0 20px rgba(255,230,0,0.5);
  }
  .balance-unit {
    font-size: 14px;
    color: var(--muted);
    margin-left: 6px;
  }
  .stats-mini {
    text-align: right;
  }
  .stat-row {
    font-size: 11px;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .stat-val {
    color: var(--text);
  }

  /* Game section */
  .game-card {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 32px;
    margin-bottom: 20px;
    position: relative;
  }
  .game-card::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--neon2), transparent);
  }

  .section-title {
    font-size: 10px;
    letter-spacing: 4px;
    text-transform: uppercase;
    color: var(--neon2);
    margin-bottom: 28px;
  }

  /* Dice area */
  .dice-arena {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 30px 0;
  }

  .die {
    width: 90px;
    height: 90px;
    background: #111122;
    border: 2px solid var(--border);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Bebas Neue', cursive;
    font-size: 52px;
    color: var(--text);
    position: relative;
    transition: all 0.1s;
    box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
  }
  .die.rolling {
    animation: roll 0.1s linear infinite;
    border-color: var(--neon);
    box-shadow: 0 0 20px rgba(0,255,225,0.3), inset 0 0 30px rgba(0,0,0,0.5);
  }
  .die.win-die {
    border-color: var(--win);
    box-shadow: 0 0 25px rgba(0,255,225,0.5);
    color: var(--win);
  }
  .die.lose-die {
    border-color: var(--lose);
    box-shadow: 0 0 25px rgba(255,45,120,0.5);
    color: var(--lose);
  }
  @keyframes roll {
    0% { transform: rotate(-5deg) scale(1.02); }
    50% { transform: rotate(5deg) scale(0.98); }
    100% { transform: rotate(-5deg) scale(1.02); }
  }

  .vs-badge {
    display: flex;
    align-items: center;
    font-family: 'Bebas Neue', cursive;
    font-size: 20px;
    color: var(--muted);
    letter-spacing: 2px;
  }

  /* Predict section */
  .predict-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin: 24px 0;
  }

  .predict-label {
    font-size: 10px;
    letter-spacing: 3px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 12px;
  }

  .predict-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
  }

  .num-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 16px;
    font-weight: 700;
    padding: 12px 6px;
    cursor: pointer;
    transition: all 0.15s;
    text-align: center;
  }
  .num-btn:hover {
    border-color: var(--neon);
    color: var(--neon);
    background: rgba(0,255,225,0.05);
  }
  .num-btn.active {
    background: rgba(0,255,225,0.12);
    border-color: var(--neon);
    color: var(--neon);
    box-shadow: 0 0 10px rgba(0,255,225,0.2);
  }

  /* Higher/Lower */
  .hl-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    grid-column: 1 / -1;
    margin-top: 4px;
  }
  .hl-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: 'Bebas Neue', cursive;
    font-size: 20px;
    letter-spacing: 3px;
    padding: 14px;
    cursor: pointer;
    transition: all 0.15s;
    text-align: center;
  }
  .hl-btn:hover { border-color: var(--neon3); color: var(--neon3); background: rgba(255,230,0,0.05); }
  .hl-btn.active { background: rgba(255,230,0,0.12); border-color: var(--neon3); color: var(--neon3); box-shadow: 0 0 12px rgba(255,230,0,0.2); }

  /* Bet input */
  .bet-section {
    margin: 24px 0;
  }
  .bet-row {
    display: flex;
    gap: 10px;
    align-items: stretch;
  }
  .bet-input-wrap {
    flex: 1;
    position: relative;
  }
  .bet-input {
    width: 100%;
    background: #111122;
    border: 1px solid var(--border);
    color: var(--neon3);
    font-family: 'Bebas Neue', cursive;
    font-size: 28px;
    letter-spacing: 2px;
    padding: 14px 70px 14px 18px;
    outline: none;
    transition: border-color 0.2s;
  }
  .bet-input:focus { border-color: var(--neon3); }
  .bet-unit-label {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 2px;
  }
  .quick-bet-btns {
    display: flex;
    gap: 6px;
    margin-top: 10px;
  }
  .quick-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 11px;
    padding: 6px 12px;
    cursor: pointer;
    transition: all 0.15s;
    letter-spacing: 1px;
  }
  .quick-btn:hover { border-color: var(--neon3); color: var(--neon3); }

  /* Mode selector */
  .mode-tabs {
    display: flex;
    gap: 0;
    margin-bottom: 20px;
    border: 1px solid var(--border);
  }
  .mode-tab {
    flex: 1;
    background: transparent;
    border: none;
    border-right: 1px solid var(--border);
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 12px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .mode-tab:last-child { border-right: none; }
  .mode-tab.active { background: rgba(0,255,225,0.08); color: var(--neon); }
  .mode-tab:hover:not(.active) { color: var(--text); background: rgba(255,255,255,0.03); }

  /* Roll button */
  .roll-btn {
    width: 100%;
    background: transparent;
    border: 2px solid var(--neon2);
    color: var(--neon2);
    font-family: 'Bebas Neue', cursive;
    font-size: 28px;
    letter-spacing: 6px;
    padding: 18px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
    margin-top: 8px;
  }
  .roll-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--neon2);
    transform: translateX(-101%);
    transition: transform 0.2s ease;
    z-index: -1;
  }
  .roll-btn:hover { color: #000; }
  .roll-btn:hover::before { transform: translateX(0); }
  .roll-btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .roll-btn:disabled::before { display: none; }

  /* Result overlay */
  .result-display {
    text-align: center;
    padding: 20px;
    margin: 16px 0;
    border: 1px solid var(--border);
    position: relative;
    overflow: hidden;
    min-height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .result-display.visible { opacity: 1; }
  .result-display.win-result { border-color: var(--win); background: rgba(0,255,225,0.05); }
  .result-display.lose-result { border-color: var(--lose); background: rgba(255,45,120,0.05); }

  .result-text {
    font-family: 'Bebas Neue', cursive;
    font-size: 36px;
    letter-spacing: 6px;
  }
  .win-result .result-text { color: var(--win); text-shadow: 0 0 20px rgba(0,255,225,0.7); }
  .lose-result .result-text { color: var(--lose); text-shadow: 0 0 20px rgba(255,45,120,0.7); }
  .result-sub {
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 2px;
    margin-top: 4px;
  }

  /* History */
  .history-card {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 24px;
    position: relative;
  }
  .history-card::after {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--muted), transparent);
  }
  .history-list { margin-top: 16px; }
  .history-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    font-size: 12px;
    animation: slide-in 0.3s ease;
  }
  @keyframes slide-in { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
  .history-item:last-child { border-bottom: none; }
  .h-dice { color: var(--muted); letter-spacing: 2px; }
  .h-result { font-weight: 700; }
  .h-result.w { color: var(--win); }
  .h-result.l { color: var(--lose); }
  .h-amount.w { color: var(--win); }
  .h-amount.l { color: var(--lose); }
  .h-time { color: var(--muted); font-size: 10px; }

  /* Payout info */
  .payout-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1px;
    background: var(--border);
    margin-top: 20px;
  }
  .payout-cell {
    background: var(--surface);
    padding: 14px;
    text-align: center;
  }
  .payout-name { font-size: 9px; letter-spacing: 2px; color: var(--muted); text-transform: uppercase; margin-bottom: 6px; }
  .payout-val { font-family: 'Bebas Neue', cursive; font-size: 22px; letter-spacing: 1px; }
  .payout-cell:nth-child(1) .payout-val { color: var(--neon); }
  .payout-cell:nth-child(2) .payout-val { color: var(--neon3); }
  .payout-cell:nth-child(3) .payout-val { color: var(--neon2); }

  /* P2P status */
  .p2p-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    border: 1px solid rgba(0,255,225,0.15);
    background: rgba(0,255,225,0.03);
    margin-bottom: 20px;
  }
  .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--neon);
    animation: blink 1.5s ease-in-out infinite;
  }
  @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
  .p2p-text { font-size: 10px; letter-spacing: 2px; color: var(--muted); text-transform: uppercase; flex: 1; }
  .p2p-peers { font-size: 10px; color: var(--neon); letter-spacing: 1px; }

  /* Footer */
  footer {
    text-align: center;
    margin-top: 40px;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 2px;
    line-height: 2;
  }
  footer a { color: var(--muted); text-decoration: none; }
  footer a:hover { color: var(--neon); }

  /* Multiplier badge */
  .multi-badge {
    display: inline-block;
    border: 1px solid rgba(255,230,0,0.3);
    color: var(--neon3);
    font-size: 10px;
    letter-spacing: 2px;
    padding: 3px 10px;
    margin-left: 10px;
    vertical-align: middle;
  }

  @media (max-width: 480px) {
    .predict-section { grid-template-columns: 1fr; }
    .die { width: 70px; height: 70px; font-size: 40px; }
    .logo { font-size: 60px; }
  }
</style>
</head>
<body>

<div class="scanline"></div>

<div class="container">

  <header>
    <div class="logo">TracDice</div>
    <div class="tagline">P2P On-Chain Dice Â· Powered by Intercom + Trac Network</div>
    <div class="network-badge">ðŸ”´ LIVE Â· MAINNET</div>
  </header>

  <!-- P2P Status Bar -->
  <div class="p2p-bar">
    <div class="dot"></div>
    <div class="p2p-text">Intercom P2P Channel Active</div>
    <div class="p2p-peers" id="peerCount">â¬¡ 7 Peers Connected</div>
  </div>

  <!-- Balance -->
  <div class="balance-card">
    <div>
      <div class="balance-label">Your Balance</div>
      <div class="balance-amount" id="balanceDisplay">1,000<span class="balance-unit">TNK</span></div>
    </div>
    <div class="stats-mini">
      <div class="stat-row">W/L: <span class="stat-val" id="wlDisplay">0/0</span></div>
      <div class="stat-row">Net: <span class="stat-val" id="netDisplay">+0</span> TNK</div>
      <div class="stat-row">Streak: <span class="stat-val" id="streakDisplay">â€”</span></div>
    </div>
  </div>

  <!-- Game Card -->
  <div class="game-card">
    <div class="section-title">// Place Your Bet</div>

    <!-- Mode tabs -->
    <div class="mode-tabs">
      <button class="mode-tab active" onclick="setMode('exact')" id="tab-exact">Exact Number</button>
      <button class="mode-tab" onclick="setMode('hl')" id="tab-hl">High / Low</button>
      <button class="mode-tab" onclick="setMode('even')" id="tab-even">Even / Odd</button>
    </div>

    <!-- Prediction inputs (changes by mode) -->
    <div id="predict-exact">
      <div class="predict-label">Pick a number (1â€“6) Â· Payout 5Ã—<span class="multi-badge">5Ã— MULTIPLIER</span></div>
      <div class="predict-grid" id="numGrid">
        <button class="num-btn" onclick="selectNum(1)">1</button>
        <button class="num-btn" onclick="selectNum(2)">2</button>
        <button class="num-btn" onclick="selectNum(3)">3</button>
        <button class="num-btn" onclick="selectNum(4)">4</button>
        <button class="num-btn" onclick="selectNum(5)">5</button>
        <button class="num-btn" onclick="selectNum(6)">6</button>
      </div>
    </div>

    <div id="predict-hl" style="display:none;">
      <div class="predict-label">High (4-6) or Low (1-3) Â· Payout 2Ã—<span class="multi-badge">2Ã— MULTIPLIER</span></div>
      <div class="hl-grid">
        <button class="hl-btn" onclick="selectHL('high')" id="btn-high">â–² HIGH (4â€“6)</button>
        <button class="hl-btn" onclick="selectHL('low')" id="btn-low">â–¼ LOW (1â€“3)</button>
      </div>
    </div>

    <div id="predict-even" style="display:none;">
      <div class="predict-label">Even or Odd Â· Payout 2Ã—<span class="multi-badge">2Ã— MULTIPLIER</span></div>
      <div class="hl-grid">
        <button class="hl-btn" onclick="selectEO('even')" id="btn-even">â—† EVEN</button>
        <button class="hl-btn" onclick="selectEO('odd')" id="btn-odd">â—‡ ODD</button>
      </div>
    </div>

    <!-- Dice -->
    <div class="dice-arena">
      <div class="die" id="die1">?</div>
      <div class="vs-badge">VS</div>
      <div class="die" id="die2">?</div>
    </div>

    <!-- Bet input -->
    <div class="bet-section">
      <div class="predict-label">Bet Amount</div>
      <div class="bet-row">
        <div class="bet-input-wrap">
          <input type="number" class="bet-input" id="betInput" value="50" min="1" max="1000">
          <span class="bet-unit-label">TNK</span>
        </div>
      </div>
      <div class="quick-bet-btns">
        <button class="quick-btn" onclick="setBet(10)">10</button>
        <button class="quick-btn" onclick="setBet(50)">50</button>
        <button class="quick-btn" onclick="setBet(100)">100</button>
        <button class="quick-btn" onclick="setBet(250)">250</button>
        <button class="quick-btn" onclick="halfBet()">Â½</button>
        <button class="quick-btn" onclick="maxBet()">MAX</button>
      </div>
    </div>

    <!-- Result -->
    <div class="result-display" id="resultDisplay">
      <div class="result-text" id="resultText"></div>
      <div class="result-sub" id="resultSub"></div>
    </div>

    <!-- Roll -->
    <button class="roll-btn" id="rollBtn" onclick="roll()">ðŸŽ² ROLL THE DICE</button>

    <!-- Payout table -->
    <div class="payout-grid">
      <div class="payout-cell">
        <div class="payout-name">Exact Hit</div>
        <div class="payout-val">5Ã—</div>
      </div>
      <div class="payout-cell">
        <div class="payout-name">High/Low</div>
        <div class="payout-val">2Ã—</div>
      </div>
      <div class="payout-cell">
        <div class="payout-name">Even/Odd</div>
        <div class="payout-val">2Ã—</div>
      </div>
    </div>
  </div>

  <!-- History -->
  <div class="history-card">
    <div class="section-title">// Recent Rolls</div>
    <div class="history-list" id="historyList">
      <div style="color:var(--muted);font-size:11px;text-align:center;padding:20px;letter-spacing:2px;">NO ROLLS YET â€” PLACE YOUR FIRST BET</div>
    </div>
  </div>

  <footer>
    <div>TracDice Â· Fork of <a href="https://github.com/Trac-Systems/intercom" target="_blank">Intercom</a> by Trac Systems</div>
    <div>Built on Trac Network Â· P2P Dice Casino Â· All bets settled on-chain</div>
    <div style="margin-top:12px;color:rgba(255,255,255,0.2)">
      Trac Address: <span style="color:var(--neon);letter-spacing:2px;">YOUR_TRAC_ADDRESS_HERE</span>
    </div>
  </footer>

</div>

<script>
  // Game state
  let balance = 1000;
  let wins = 0;
  let losses = 0;
  let netPnl = 0;
  let streak = 0;
  let streakType = null;
  let history = [];

  // Selection state
  let mode = 'exact';
  let selectedNum = null;
  let selectedHL = null;
  let selectedEO = null;
  let rolling = false;

  // Peer count animation
  setInterval(() => {
    const peers = Math.floor(Math.random() * 5) + 5;
    document.getElementById('peerCount').textContent = `â¬¡ ${peers} Peers Connected`;
  }, 4000);

  function setMode(m) {
    mode = m;
    selectedNum = null; selectedHL = null; selectedEO = null;
    ['exact','hl','even'].forEach(x => {
      document.getElementById('predict-' + x).style.display = x === m ? 'block' : 'none';
      document.getElementById('tab-' + x).classList.toggle('active', x === m);
    });
    clearResult();
  }

  function selectNum(n) {
    selectedNum = n;
    document.querySelectorAll('.num-btn').forEach((b, i) => {
      b.classList.toggle('active', i + 1 === n);
    });
  }

  function selectHL(v) {
    selectedHL = v;
    document.getElementById('btn-high').classList.toggle('active', v === 'high');
    document.getElementById('btn-low').classList.toggle('active', v === 'low');
  }

  function selectEO(v) {
    selectedEO = v;
    document.getElementById('btn-even').classList.toggle('active', v === 'even');
    document.getElementById('btn-odd').classList.toggle('active', v === 'odd');
  }

  function setBet(v) {
    document.getElementById('betInput').value = Math.min(v, balance);
  }
  function halfBet() {
    const cur = parseInt(document.getElementById('betInput').value) || 0;
    document.getElementById('betInput').value = Math.max(1, Math.floor(cur / 2));
  }
  function maxBet() { document.getElementById('betInput').value = balance; }

  function clearResult() {
    const rd = document.getElementById('resultDisplay');
    rd.className = 'result-display';
    document.getElementById('die1').className = 'die';
    document.getElementById('die2').className = 'die';
    document.getElementById('die1').textContent = '?';
    document.getElementById('die2').textContent = '?';
  }

  function roll() {
    if (rolling) return;

    // Validate selection
    if (mode === 'exact' && selectedNum === null) { alert('Pick a number 1â€“6 first!'); return; }
    if (mode === 'hl' && selectedHL === null) { alert('Pick High or Low first!'); return; }
    if (mode === 'even' && selectedEO === null) { alert('Pick Even or Odd first!'); return; }

    const bet = parseInt(document.getElementById('betInput').value);
    if (!bet || bet < 1) { alert('Enter a valid bet!'); return; }
    if (bet > balance) { alert('Not enough TNK!'); return; }

    rolling = true;
    document.getElementById('rollBtn').disabled = true;
    clearResult();

    const d1 = document.getElementById('die1');
    const d2 = document.getElementById('die2');
    d1.classList.add('rolling');
    d2.classList.add('rolling');

    // Roll animation
    const faces = ['âš€','âš','âš‚','âšƒ','âš„','âš…'];
    let t = 0;
    const rollInterval = setInterval(() => {
      d1.textContent = Math.ceil(Math.random() * 6);
      d2.textContent = Math.ceil(Math.random() * 6);
      t++;
      if (t > 18) {
        clearInterval(rollInterval);
        finishRoll(bet, d1, d2);
      }
    }, 60);
  }

  function finishRoll(bet, d1, d2) {
    const r1 = Math.ceil(Math.random() * 6);
    const r2 = Math.ceil(Math.random() * 6);
    d1.textContent = r1;
    d2.textContent = r2;
    d1.classList.remove('rolling');
    d2.classList.remove('rolling');

    // Determine result based on mode
    let won = false;
    let multiplier = 1;
    let resultLabel = '';

    if (mode === 'exact') {
      won = r1 === selectedNum;
      multiplier = 5;
      resultLabel = `You picked ${selectedNum} Â· Rolled ${r1}`;
    } else if (mode === 'hl') {
      const high = r1 >= 4;
      won = (selectedHL === 'high' && high) || (selectedHL === 'low' && !high);
      multiplier = 2;
      resultLabel = `You picked ${selectedHL.toUpperCase()} Â· Rolled ${r1}`;
    } else if (mode === 'even') {
      const isEven = r1 % 2 === 0;
      won = (selectedEO === 'even' && isEven) || (selectedEO === 'odd' && !isEven);
      multiplier = 2;
      resultLabel = `You picked ${selectedEO.toUpperCase()} Â· Rolled ${r1}`;
    }

    // Update balance
    if (won) {
      const gain = bet * (multiplier - 1);
      balance += gain;
      netPnl += gain;
      wins++;
      streak = streakType === 'W' ? streak + 1 : 1;
      streakType = 'W';
      d1.classList.add('win-die');
    } else {
      balance -= bet;
      netPnl -= bet;
      losses++;
      streak = streakType === 'L' ? streak + 1 : 1;
      streakType = 'L';
      d1.classList.add('lose-die');
    }
    d2.classList.add(won ? 'win-die' : 'lose-die');

    // Update UI
    updateStats();
    showResult(won, bet, multiplier, resultLabel, r1, r2);
    addHistory(won, bet, multiplier, r1, r2);

    rolling = false;
    document.getElementById('rollBtn').disabled = false;

    // Auto-disable if broke
    if (balance <= 0) {
      balance = 0;
      updateStats();
      setTimeout(() => alert('ðŸ’€ You\'re broke! Demo balance reset to 1000 TNK'), 500);
      setTimeout(() => { balance = 1000; updateStats(); }, 800);
    }
  }

  function showResult(won, bet, mult, label, r1, r2) {
    const rd = document.getElementById('resultDisplay');
    const rt = document.getElementById('resultText');
    const rs = document.getElementById('resultSub');
    rd.className = 'result-display visible ' + (won ? 'win-result' : 'lose-result');
    rt.textContent = won ? `WIN +${bet * (mult - 1)} TNK` : `LOSS âˆ’${bet} TNK`;
    rs.textContent = label + ` (both dice: ${r1}, ${r2})`;
  }

  function updateStats() {
    document.getElementById('balanceDisplay').innerHTML =
      balance.toLocaleString() + '<span class="balance-unit">TNK</span>';
    document.getElementById('wlDisplay').textContent = wins + '/' + losses;
    document.getElementById('netDisplay').textContent = (netPnl >= 0 ? '+' : '') + netPnl;
    document.getElementById('netDisplay').style.color = netPnl >= 0 ? 'var(--win)' : 'var(--lose)';
    document.getElementById('streakDisplay').textContent = streak > 0 ? `${streakType}${streak}` : 'â€”';
  }

  function addHistory(won, bet, mult, r1, r2) {
    history.unshift({ won, bet, mult, r1, r2, time: new Date() });
    if (history.length > 8) history.pop();
    renderHistory();
  }

  function renderHistory() {
    const list = document.getElementById('historyList');
    if (history.length === 0) return;
    list.innerHTML = history.map(h => {
      const gain = h.won ? `+${h.bet * (h.mult - 1)}` : `-${h.bet}`;
      const cls = h.won ? 'w' : 'l';
      const timeStr = h.time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      return `<div class="history-item">
        <span class="h-dice">ðŸŽ² ${h.r1} Â· ${h.r2}</span>
        <span class="h-result ${cls}">${h.won ? 'âœ“ WIN' : 'âœ— LOSE'}</span>
        <span class="h-amount ${cls}">${gain} TNK</span>
        <span class="h-time">${timeStr}</span>
      </div>`;
    }).join('');
  }
</script>
</body>
</html>
